<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="lv2.css">
</head>
<body>
    <div class="menu">
        <button onclick="choose(this)">æ­Œæ›²åˆ—è¡¨</button>
        <button class="comment" onclick="choose(this)">è¯„è®º(0)</button>
        <button onclick="choose(this)">æ”¶è—è€…</button>
        <div class="underline"></div>
    </div>
    <div id="comment-section">
    <textarea type="text" class="commentPlace" placeholder="è¯·è¾“å…¥è¯„è®º"></textarea>
    <div class="comment-zone">
        <span class="items">
            <button onclick="insertSymbol('#')">#</button>
            <button onclick="insertSymbol('@')">@</button>
            <button onclick="insertSymbol('ğŸ˜Š')">ğŸ˜Š</button>

        </span>
        <span>
            <button class="comment-button" onclick="handleCommentClick()">è¯„è®º</button>
        </span>
    </div>
    <div class="comment-list" id="comment-list">
        <p class="no-comment">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘</p>
    </div>
</div>

    </div>
<div id="user-modal" class="user-modal">
    <div class="modal-content">
        <h3>è¯·é€‰æ‹©æ˜µç§°ä¸å¤´åƒ</h3>

        <label>æ˜µç§°ï¼š</label>
        <input type="text" id="nickname-input" placeholder="è¯·è¾“å…¥æ˜µç§°">

        <p>é€‰æ‹©å¤´åƒï¼š</p>
        <div class="avatar-select">
            <img src="å¤´åƒ\è‰å¸½.jpg" onclick="chooseAvatar(this)">
            <img src="å¤´åƒ\æ«å¶.jpg" onclick="chooseAvatar(this)">
            <img src="å¤´åƒ\çœ¼é•œ.jpg" onclick="chooseAvatar(this)">
        </div>

        <button class="modal-btn" onclick="confirmUserInfo()">ç¡®å®š</button>
    </div>
</div>
<div id="delete-menu" class="delete-menu">
    <button onclick="deleteComment()">åˆ é™¤</button>
</div>

    <script>
    const underline = document.querySelector(".underline");
    const buttons = document.querySelectorAll(".menu button");
    const commentBtn=document.querySelector(".comment");
    const commentInput=document.querySelector(".commentPlace");
    const commentList=document.getElementById("comment-list");
    const commentSection = document.getElementById("comment-section");
    const emptySection = document.getElementById("empty-section");

    window.onload = () => {
        choose(document.querySelector(".comment"));
    };

    let commentCount=0;
    let userAvatar = "";
    let userNickname = "";
    let userInfoSet = false;
    let currentComment = null; 

function showDeleteMenu(x, y, commentItem) {
    const menu = document.getElementById("delete-menu");
    currentComment = commentItem;

    menu.style.left = x + "px";
    menu.style.top = y + "px";
    menu.style.display = "block";
}

function deleteComment() {
    if (currentComment) {
        currentComment.remove(); 

        commentCount = Math.max(0, commentCount - 1);

        updateCommentCount();

        if (commentList.children.length === 0) {
            const p = document.createElement("p");
            p.className = "no-comment";
            p.textContent = "è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘";
            commentList.appendChild(p);
        }

        currentComment = null;
    }

    document.getElementById("delete-menu").style.display = "none";
}


document.addEventListener("click", () => {
    document.getElementById("delete-menu").style.display = "none";
});

    function choose(btn) {

    buttons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    const rect = btn.getBoundingClientRect();
    const parentRect = btn.parentNode.getBoundingClientRect();
    underline.style.left = (rect.left - parentRect.left) + "px";
    underline.style.width = rect.width + "px";


    const text = btn.textContent;

    if (text.includes("è¯„è®º")) {
        commentSection.style.display = "block";
        emptySection.style.display = "none";
    } else {
        commentSection.style.display = "none";
        emptySection.style.display = "block";
    }
}

    function handleCommentClick() {
    if (!userInfoSet) {
        document.getElementById("user-modal").style.display = "flex";
        return;
    }
    submitComment(); 
}
    function chooseAvatar(img) {
    document.querySelectorAll(".avatar-select img")
        .forEach(i => i.classList.remove("selected"));
    img.classList.add("selected");
    userAvatar = img.src;
}
    function confirmUserInfo() {
    const nicknameInput = document.getElementById("nickname-input").value.trim();

    if (!nicknameInput || !userAvatar) {
        alert("è¯·å¡«å†™æ˜µç§°å¹¶é€‰æ‹©å¤´åƒ");
        return;
    }

    userNickname = nicknameInput;
    userInfoSet = true;

    document.getElementById("user-modal").style.display = "none";
    alert("ç”¨æˆ·ä¿¡æ¯è®¾ç½®æˆåŠŸï¼ç°åœ¨å¯ä»¥è¯„è®ºäº†");
}

    function submitComment(){
        const text=commentInput.value.trim();
        if(!text){
            alert('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º');
            return;
        }
        alert('è¯„è®ºæˆåŠŸï¼');

        commentCount++;

        updateCommentCount();

        addCommentToList(text);

        commentInput.value="";
    }

    function updateCommentCount(){
        commentBtn.textContent=`è¯„è®º(${commentCount})`;
    }

    function addCommentToList(text){
    const noComment = document.querySelector(".no-comment");
    if(noComment){
        noComment.remove();
    }

    const item = document.createElement("div");
    item.className = "comment-item";

    const now = new Date();
    const time = now.getHours() + ":" + String(now.getMinutes()).padStart(2,"0");

    item.innerHTML = `
        <div class="avatar">
            <img src="${userAvatar}" style="width:40px;height:40px;border-radius:50%">
        </div>
        <div class="comment-content">
            <div class="comment-header">${userNickname} Â· ${time}</div>
            <div class="comment-text">${text}</div>
        </div>
    `;


    item.addEventListener("contextmenu", function (e) {
        e.preventDefault(); 
        showDeleteMenu(e.pageX, e.pageY, item);
    });

    commentList.prepend(item);
}

    function insertSymbol(symbol) {
    const input = commentInput;  
    const start = input.selectionStart; 
    const end = input.selectionEnd;   
    const text = input.value;


    input.value = text.slice(0, start) + symbol + text.slice(end);


    const cursor = start + symbol.length;
    input.setSelectionRange(cursor, cursor);


    input.focus();
}

    </script>
</body>
</html>